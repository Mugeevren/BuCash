var app=angular.module("BuCash",["ui.router","ngSanitize","ui.select","LocalStorageModule"]);app.config(function(e,n,o){o.setPrefix("BuCash"),n.otherwise("/homedashboard"),e.state("homedashboard",{url:"/homedashboard",templateUrl:"app/views/homedashboard.html",controller:"HomeDashboardController"}),e.state("userdashboard",{url:"/userdashboard",templateUrl:"app/views/userdashboard.html",controller:"UserDashboardController",data:{auth:"user"}}),e.state("pointdashboard",{url:"/pointdashboard",templateUrl:"app/views/pointdashboard.html",controller:"PointDashboardController",data:{auth:"point"}})}),app.controller("MainController",["$scope","$rootScope","Auth","$state",function(e,n,o,t){e.modalShown=!1,e.openUserLoginModal=function(){e.modalShown=!0,e.isUserLoginOpened=!0,e.isBucashPointLoginOpened=!1},e.openPointLoginModal=function(){e.modalShown=!0,e.isBucashPointLoginOpened=!0,e.isUserLoginOpened=!1},e.LogOut=function(){o.Logout(),o.SetState(null),n.loggedInUser=void 0,n.loggedInUserId=void 0,n.isLoggedIn=!1,t.go("homedashboard")},n.$on("$stateChangeStart",function(e,n,t,i,r){return(o.isLogin()||_.isUndefined(n.data)||_.isUndefined(n.data.auth)||"user"!==n.data.auth&&"point"!==n.data.auth)&&(_.isUndefined(n.data)||_.isUndefined(n.data.auth)||"user"!==n.data.auth||"user"==o.GetState())&&(_.isUndefined(n.data)||_.isUndefined(n.data.auth)||"point"!==n.data.auth||"point"==o.GetState())?void 0:(e.preventDefault(),!1)})}]),app.controller("DashboardController",["$scope",function(e){}]),app.controller("HomeDashboardController",["$scope",function(e){}]),app.controller("PointDashboardController",["$scope","$rootScope","http",function(e,n,o){e.Name=n.loggedInUser,e.Id=n.loggedInUserId,e.GetPointInfo=function(t){var i={id:t||e.Id};o.get("GetPointInfo",i).then(function(o){e.point=o.data.point,n.loggedInUser=o.data.name})},n.onPointUpdateModalOpen=function(){e.updatePointInfoModalShown=!0},n.onCreateTransferModalOpen=function(){e.transferCreateModalShown=!0},n.onTransmissionModalOpen=function(){e.transmissionModalShown=!0},n.onRefundModalOpen=function(){e.refundModalShown=!0},e.GetPointInfo(e.Id)}]),app.controller("UserDashboardController",["$scope","$rootScope","http",function(e,n,o){e.Name=n.loggedInUser,e.Id=n.loggedInUserId,e.GetUserInfo=function(t){var i={id:t};o.get("GetUserInfo",i).then(function(o){e.user=o.data.user,n.loggedInUser=o.data.user.name})},e.GetUserInfo(e.Id)}]),app.service("Auth",["localStorageService","http","$q",function(e,n,o){e.set("isLogin",0),this.Login=function(){var n=o.defer();return e.set("isLogin",1),n.resolve(this.isLogin()),n.promise},this.Logout=function(){e.set("isLogin",0),e.set("UserState",null)},this.getUser=function(e){var t=o.defer(),i={id:e};return n.get("GetUser",i).then(function(e){t.resolve(e)}),t.promise},this.isLogin=function(){return 1==e.get("isLogin")},this.SetState=function(n){e.set("UserState",n)},this.GetState=function(){return e.get("UserState")}}]),app.service("http",["$http","$q",function(e,n){var o=function(e,n){return"http://localhost:3000/"+e};this.post=function(t,i){var r=n.defer(),s=o(t);return console.log(i),e.post(s,i).then(function(e){r.resolve(e)},function(e){r.reject("Oops... something went wrong")}),r.promise},this.get=function(t,i){var r=n.defer(),s=o(t),a={params:i,headers:{Accept:"application/json"}};return e.get(s,a).then(function(e){r.resolve(e)},function(e){r.reject("Oops... something went wrong")}),r.promise}}]),app.directive("loginModal",[function(){return{restrict:"E",templateUrl:"app/directives/loginmodal.html",replace:!1,scope:{show:"=showModal",isUserLoginOpened:"=?isUserLoginOpened",isBucashPointLoginOpened:"=?isBucashPointLoginOpened"},controller:["$scope","$rootScope","$state","Auth","http","$timeout",function(e,n,o,t,i,r){e.user={},e.dismiss=function(){e.user={},e.show=!1,e.loginErrorMessage=void 0,e.loginErrorVisible=!1},e.onLoginButtonClick=function(){if(e.loginErrorMessage=void 0,e.loginErrorVisible=!1,e.isUserLoginOpened){console.log("mÃ¼ge login");var r={username:e.user.name,password:e.user.password};i.post("LoginUser",r).then(function(i){i.data.id?(t.Login().then(function(e){n.isLoggedIn=e}),n.loggedInUserId=i.data.id,t.SetState("user"),e.dismiss(),o.go("userdashboard")):i.data.message&&(e.user={},e.loginErrorMessage=i.data.message,e.loginErrorVisible=!0)})}else if(e.isBucashPointLoginOpened){console.log("sgdgafgadf");var r={username:e.user.name,password:e.user.password};i.post("LoginPoint",r).then(function(i){i.data.id?(t.Login().then(function(e){n.isLoggedIn=e}),n.loggedInUserId=i.data.id,t.SetState("point"),e.dismiss(),o.go("pointdashboard")):i.data.message&&(e.user={},e.loginErrorMessage=i.data.message,e.loginErrorVisible=!0)})}}}],link:function(e,n,o){}}}]),app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"=showModal",onCloseModal:"=?onCloseModal"},transclude:!0,controller:["$scope",function(e){e.hideModal=function(){e.show=!1,_.isFunction(e.onCloseModal)&&e.onCloseModal()}}],link:function(e,n,o){console.log("attrs: ",o),e.dialogStyle={},o.boxWidth&&(e.dialogStyle.width=o.boxWidth),o.boxHeight&&(e.dialogStyle.height=o.boxHeight),e.hideModal=function(){e.show=!1,_.isFunction(e.onCloseModal)&&e.onCloseModal()}},templateUrl:"app/directives/modaldialog.html"}}),app.directive("pointinfoUpdateModal",[function(){return{restrict:"E",templateUrl:"app/directives/pointinfoupdatemodal.html",replace:!1,scope:{show:"=showModal",pointId:"=pointId",onModalClosed:"=?onModalClosed"},controller:["$scope","$rootScope","$state","http",function(e,n,o,t){t.get("GetPointInfo",{id:e.pointId}).then(function(n){e.point=n.data.point}),e.onWorkingHoursDivOpen=function(){e.workingHoursDivOpen=!e.workingHoursDivOpen,e.addresInfoDivOpen=!1,e.pointInfoDivOpen=!1},e.onAddressInfoDivOpen=function(){e.addresInfoDivOpen=!e.addresInfoDivOpen,e.workingHoursDivOpen=!1,e.pointInfoDivOpen=!1},e.onPointInfoDivOpen=function(){e.pointInfoDivOpen=!e.pointInfoDivOpen,e.workingHoursDivOpen=!1,e.addresInfoDivOpen=!1},e.onAddressInfoUpdate=function(){var n={id:e.pointId,address:e.point.address};t.post("UpdatePointAddress",n).then(function(e){e.data})},e.onWorkingHoursUpdate=function(){var n={id:e.pointId,workingHours:e.point.workingHours};t.post("UpdatePointWorkingHours",n).then(function(e){})},e.onPointInfoUpdate=function(){var n={id:e.pointId,point:{name:e.point.name,image:e.point.image}};t.post("UpdatePointInfo",n).then(function(e){})}}],link:function(e,n,o){}}}]),app.directive("transferCreateModal",[function(){return{restrict:"E",templateUrl:"app/directives/transfercreatemodal.html",replace:!1,scope:{show:"=showModal",title:"@title",onModalClosed:"=?onModalClosed"},controller:["$scope","$rootScope","$state","http",function(e,n,o,t){e.$watch("show",function(n,o){n==o||n||(e.transfer={},e.input={},e.clearDisplayContainers(),e.isSenderContainerVisible=!0,e.isTransferConfimed=!1,e.isSenderSearchSuccess=!1,e.isReceiverSearchSuccess=!1)}),e.transfer={},e.input={},e.isSenderContainerVisible=!0,e.clearDisplayContainers=function(){e.isSenderContainerVisible=!1,e.isReceiverContainerVisible=!1,e.isTransferInfoContainerVisible=!1,e.isConfirmationContainerVisible=!1,e.isTransferSummaryContainerVisible=!1},e.showSenderContainer=function(){e.isTransferConfimed||(e.clearDisplayContainers(),e.isSenderContainerVisible=!0)},e.showReceiverContainer=function(){!e.isTransferConfimed&&e.isSenderSearchSuccess&&(e.clearDisplayContainers(),e.isReceiverContainerVisible=!0)},e.showTransferInfoContainer=function(){!e.isTransferConfimed&&e.isReceiverSearchSuccess&&(e.clearDisplayContainers(),e.isTransferInfoContainerVisible=!0)},e.showConfirmationContainer=function(){!e.isTransferConfimed&&void 0!=e.transfer.amount&&e.transfer.amount.length>0&&(e.clearDisplayContainers(),e.isConfirmationContainerVisible=!0)},e.showTransferSummaryContainer=function(){e.isTransferConfimed&&(e.clearDisplayContainers(),e.isTransferSummaryContainerVisible=!0)},e.onSearchSenderClick=function(){var n={searchQuery:e.input.searchSenderQuery};t.post("GetUsersByPhoneOrIdentificationNumber",n).then(function(n){n.data.user?(e.transfer.sender=n.data.user,e.isSenderSearchSuccess=!0):(e.noSenderUserMessage=n.data.message,e.isSenderSearchSuccess=!1),e.input.searchSenderQuery=void 0})},e.onSearchReceiverClick=function(){var n={searchQuery:e.input.searchReceiverQuery};t.post("GetUsersByPhoneOrIdentificationNumber",n).then(function(n){n.data.user?(e.transfer.receiver=n.data.user,e.isReceiverSearchSuccess=!0):(e.noReceiverUserMessage=n.data.message,e.isReceiverSearchSuccess=!1),e.input.searchReceiverQuery=void 0})},e.onConfirmTransferClick=function(){e.transfer.receiverPoint={name:n.loggedInUser,id:n.loggedInUserId},e.transfer.receivingDate=moment().format("dd/MM/YYYY");var o={transfer:e.transfer};t.post("AddNewTransfer",o).then(function(n){n.data.message&&(e.isTransferConfimed=!0,e.showTransferSummaryContainer())})}}],link:function(e,n,o){}}}]),app.directive("transferList",[function(){return{restrict:"E",templateUrl:"app/directives/transferlist.html",replace:!1,scope:{list:"=?list"},controller:["$scope","$rootScope","$state",function(e,n,o){e.$watch("$scope.list",function(){e.list})}],link:function(e,n,o){}}}]),app.directive("transmissionRefundModal",[function(){return{restrict:"E",templateUrl:"app/directives/transmissionrefundmodal.html",replace:!1,scope:{show:"=showModal",title:"@title",headerLevelOne:"@headerLevelOne",headerLevelTwo:"@headerLevelTwo",headerLevelThree:"@headerLevelThree"},controller:["$scope","$rootScope","$state",function(e,n,o){e.onWorkingHoursDivOpen=function(){e.workingHoursDivOpen=!e.workingHoursDivOpen,e.addresInfoDivOpen=!1,e.pointInfoDivOpen=!1},e.onAddressInfoDivOpen=function(){e.addresInfoDivOpen=!e.addresInfoDivOpen,e.workingHoursDivOpen=!1,e.pointInfoDivOpen=!1},e.onPointInfoDivOpen=function(){e.pointInfoDivOpen=!e.pointInfoDivOpen,e.workingHoursDivOpen=!1,e.addresInfoDivOpen=!1}}],link:function(e,n,o){}}}]);