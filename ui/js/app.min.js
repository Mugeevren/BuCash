var app=angular.module("BuCash",["ui.router","ngSanitize","ui.select","LocalStorageModule"]);app.config(function(e,n,o){o.setPrefix("BuCash"),n.otherwise("/homedashboard"),e.state("homedashboard",{url:"/homedashboard",templateUrl:"app/views/homedashboard.html",controller:"HomeDashboardController"}),e.state("userdashboard",{url:"/userdashboard",templateUrl:"app/views/userdashboard.html",controller:"UserDashboardController",data:{auth:"user"}}),e.state("pointdashboard",{url:"/pointdashboard",templateUrl:"app/views/pointdashboard.html",controller:"PointDashboardController",data:{auth:"point"}})}),app.controller("MainController",["$scope","$rootScope","Auth","$state",function(e,n,o,i){e.modalShown=!1,e.openUserLoginModal=function(){e.modalShown=!0,e.isUserLoginOpened=!0,e.isBucashPointLoginOpened=!1},e.openPointLoginModal=function(){e.modalShown=!0,e.isBucashPointLoginOpened=!0,e.isUserLoginOpened=!1},e.LogOut=function(){o.Logout(),o.SetState(null),n.loggedInUser=void 0,n.loggedInUserId=void 0,n.isLoggedIn=!1,i.go("homedashboard")},n.$on("$stateChangeStart",function(e,n,i,r,t){return(o.isLogin()||_.isUndefined(n.data)||_.isUndefined(n.data.auth)||"user"!==n.data.auth&&"point"!==n.data.auth)&&(_.isUndefined(n.data)||_.isUndefined(n.data.auth)||"user"!==n.data.auth||"user"==o.GetState())&&(_.isUndefined(n.data)||_.isUndefined(n.data.auth)||"point"!==n.data.auth||"point"==o.GetState())?void 0:(e.preventDefault(),!1)})}]),app.controller("DashboardController",["$scope",function(e){}]),app.controller("HomeDashboardController",["$scope",function(e){}]),app.controller("PointDashboardController",["$scope","$rootScope","http",function(e,n,o){e.Name=n.loggedInUser,e.Id=n.loggedInUserId,e.GetPointInfo=function(i){var r={id:i||e.Id};o.get("GetPointInfo",r).then(function(o){e.point=o.data.point,n.loggedInUser=o.data.point.name})},n.onPointUpdateModalOpen=function(){e.updatePointInfoModalShown=!0},n.onCreateTransferModalOpen=function(){e.transferCreateModalShown=!0},n.onTransmissionModalOpen=function(){e.transmissionModalShown=!0},n.onRefundModalOpen=function(){e.refundModalShown=!0},e.GetPointInfo(e.Id)}]),app.controller("UserDashboardController",["$scope","$rootScope","http",function(e,n,o){e.Name=n.loggedInUser,e.Id=n.loggedInUserId,e.GetUserInfo=function(i){var r={id:i};o.get("GetUserInfo",r).then(function(o){e.user=o.data,n.loggedInUser=o.data.name})},e.GetUserInfo(e.Id)}]),app.service("Auth",["localStorageService","http","$q",function(e,n,o){e.set("isLogin",0),this.Login=function(){var n=o.defer();return e.set("isLogin",1),n.resolve(this.isLogin()),n.promise},this.Logout=function(){e.set("isLogin",0),e.set("UserState",null)},this.getUser=function(e){var i=o.defer(),r={id:e};return n.get("GetUser",r).then(function(e){i.resolve(e)}),i.promise},this.isLogin=function(){return 1==e.get("isLogin")},this.SetState=function(n){e.set("UserState",n)},this.GetState=function(){return e.get("UserState")}}]),app.service("http",["$http","$q",function(e,n){var o=[];o.push({PostName:"UpdatePointInfo",FileName:"GetPointInfo"});var i=function(e,n){var i=o.filter(function(n){return n.PostName===e});if(!_.isUndefined(i)&&i.length>0){i=i[0].FileName;var t=r(i,n)}var s=require("fs");s.readFile(t,"utf-8",function(e,n){if(e)throw e;var o=JSON.parse(n);console.log(o),s.writeFile(t,JSON.stringify(o),"utf-8",function(e){if(e)throw e;console.log("Done!")})})},r=function(e,n){return _.isUndefined(n)||_.isUndefined(n.id)?"LoginUser"==e||"LoginPoint"==e?"/data/"+e+"/"+n.userName+n.password+".json":"/data/"+e+".json":"/data/"+e+"/"+n.id+".json"};this.post=function(e,o){var r=n.defer();console.log(o);return i(e,o),r.resolve(!0),r.promise},this.get=function(o,i){var t=n.defer(),s=r(o,i),a={params:i,headers:{Accept:"application/json"}};return e.get(s,a).then(function(e){t.resolve(e)},function(e){t.reject("Oops... something went wrong")}),t.promise}}]),app.directive("loginModal",[function(){return{restrict:"E",templateUrl:"app/directives/loginmodal.html",replace:!1,scope:{show:"=showModal",isUserLoginOpened:"=?isUserLoginOpened",isBucashPointLoginOpened:"=?isBucashPointLoginOpened"},controller:["$scope","$rootScope","$state","Auth","http","$timeout",function(e,n,o,i,r,t){e.user={},e.dismiss=function(){e.user={},e.show=!1,e.loginErrorMessage=void 0,e.loginErrorVisible=!1},e.onLoginButtonClick=function(){if(e.loginErrorMessage=void 0,e.loginErrorVisible=!1,e.isUserLoginOpened){console.log("mÃ¼ge login");var t={userName:e.user.name,password:e.user.password};r.get("LoginUser",t).then(function(r){r.data.UserId?(i.Login().then(function(e){n.isLoggedIn=e}),n.loggedInUserId=r.data.UserId,i.SetState("user"),e.dismiss(),o.go("userdashboard")):r.data.message&&(e.user={},e.loginErrorMessage=r.data.message,e.loginErrorVisible=!0)})}else if(e.isBucashPointLoginOpened){console.log("sgdgafgadf");var t={userName:e.user.name,password:e.user.password};r.get("LoginPoint",t).then(function(r){r.data.UserId?(i.Login().then(function(e){n.isLoggedIn=e}),n.loggedInUserId=r.data.UserId,i.SetState("point"),e.dismiss(),o.go("pointdashboard")):r.data.message&&(e.user={},e.loginErrorMessage=r.data.message,e.loginErrorVisible=!0)})}}}],link:function(e,n,o){}}}]),app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"=showModal",onCloseModal:"=?onCloseModal"},transclude:!0,controller:["$scope",function(e){e.hideModal=function(){e.show=!1,_.isFunction(e.onCloseModal)&&e.onCloseModal()}}],link:function(e,n,o){console.log("attrs: ",o),e.dialogStyle={},o.boxWidth&&(e.dialogStyle.width=o.boxWidth),o.boxHeight&&(e.dialogStyle.height=o.boxHeight),e.hideModal=function(){e.show=!1,_.isFunction(e.onCloseModal)&&e.onCloseModal()}},templateUrl:"app/directives/modaldialog.html"}}),app.directive("pointinfoUpdateModal",[function(){return{restrict:"E",templateUrl:"app/directives/pointinfoupdatemodal.html",replace:!1,scope:{show:"=showModal",pointId:"=pointId",onModalClosed:"=?onModalClosed"},controller:["$scope","$rootScope","$state","http",function(e,n,o,i){i.get("GetPointInfo",{id:e.pointId}).then(function(n){e.point=n.data.point}),e.onWorkingHoursDivOpen=function(){e.workingHoursDivOpen=!e.workingHoursDivOpen,e.addresInfoDivOpen=!1,e.pointInfoDivOpen=!1},e.onAddressInfoDivOpen=function(){e.addresInfoDivOpen=!e.addresInfoDivOpen,e.workingHoursDivOpen=!1,e.pointInfoDivOpen=!1},e.onPointInfoDivOpen=function(){e.pointInfoDivOpen=!e.pointInfoDivOpen,e.workingHoursDivOpen=!1,e.addresInfoDivOpen=!1},e.onPointInfoUpdate=function(){var n={id:e.pointId,point:{name:e.point.name,image:e.point.image}};i.post("UpdatePointInfo",n).then(function(e){})},e.onPointInfoDivOpen()}],link:function(e,n,o){}}}]),app.directive("refundModal",[function(){return{restrict:"E",templateUrl:"app/directives/refundmodal.html",replace:!1,scope:{show:"=showModal"},controller:["$scope","$rootScope","$state",function(e,n,o){}],link:function(e,n,o){}}}]),app.directive("transferCreateModal",[function(){return{restrict:"E",templateUrl:"app/directives/transfercreatemodal.html",replace:!1,scope:{show:"=showModal",title:"@title",onModalClosed:"=?onModalClosed"},controller:["$scope","$rootScope","$state","http",function(e,n,o,i){e.$watch("show",function(n,o){n==o||n||(e.transfer={},e.input={},e.clearDisplayContainers(),e.isSenderContainerVisible=!0,e.isTransferConfimed=!1,e.isSenderSearchSuccess=!1,e.isReceiverSearchSuccess=!1)}),e.transfer={},e.input={},e.isSenderContainerVisible=!0,e.clearDisplayContainers=function(){e.isSenderContainerVisible=!1,e.isReceiverContainerVisible=!1,e.isTransferInfoContainerVisible=!1,e.isConfirmationContainerVisible=!1,e.isTransferSummaryContainerVisible=!1},e.showSenderContainer=function(){e.isTransferConfimed||(e.clearDisplayContainers(),e.isSenderContainerVisible=!0)},e.showReceiverContainer=function(){!e.isTransferConfimed&&e.isSenderSearchSuccess&&(e.clearDisplayContainers(),e.isReceiverContainerVisible=!0)},e.showTransferInfoContainer=function(){!e.isTransferConfimed&&e.isReceiverSearchSuccess&&(e.clearDisplayContainers(),e.isTransferInfoContainerVisible=!0)},e.showConfirmationContainer=function(){!e.isTransferConfimed&&void 0!=e.transfer.amount&&e.transfer.amount.length>0&&(e.clearDisplayContainers(),e.isConfirmationContainerVisible=!0)},e.showTransferSummaryContainer=function(){e.isTransferConfimed&&(e.clearDisplayContainers(),e.isTransferSummaryContainerVisible=!0)},e.onSearchSenderClick=function(){var n={searchQuery:e.input.searchSenderQuery};i.post("GetUsersByPhoneOrIdentificationNumber",n).then(function(n){n.data.user?(e.transfer.sender=n.data.user,e.isSenderSearchSuccess=!0):(e.noSenderUserMessage=n.data.message,e.isSenderSearchSuccess=!1),e.input.searchSenderQuery=void 0})},e.onSearchReceiverClick=function(){var n={searchQuery:e.input.searchReceiverQuery};i.post("GetUsersByPhoneOrIdentificationNumber",n).then(function(n){n.data.user?(e.transfer.receiver=n.data.user,e.isReceiverSearchSuccess=!0):(e.noReceiverUserMessage=n.data.message,e.isReceiverSearchSuccess=!1),e.input.searchReceiverQuery=void 0})},e.onConfirmTransferClick=function(){e.transfer.receiverPoint={name:n.loggedInUser,id:n.loggedInUserId},e.transfer.receivingDate=moment().format("dd/MM/YYYY");var o={transfer:e.transfer};i.post("AddNewTransfer",o).then(function(n){n.data.message&&(e.isTransferConfimed=!0,e.showTransferSummaryContainer())})}}],link:function(e,n,o){}}}]),app.directive("transferList",[function(){return{restrict:"E",templateUrl:"app/directives/transferlist.html",replace:!1,scope:{list:"=?list"},controller:["$scope","$rootScope","$state",function(e,n,o){e.$watch("$scope.list",function(){e.list})}],link:function(e,n,o){}}}]),app.directive("transmissionRefundModal",[function(){return{restrict:"E",templateUrl:"app/directives/transmissionmodal.html",replace:!1,scope:{show:"=showModal"},controller:["$scope","$rootScope","$state","http",function(e,n,o,i){e.onSearchTransmissionCodeClick=function(){var n={transmissionCode:e.input.searchTransmissionCode};i.post("GetTransferByTransmissionCode",n).then(function(n){n.data.transfer?(e.transfer=n.data.transfer,e.isTransferCodeSearchSuccess=!0):e.isTransferCodeSearchSuccess=!1,e.input.searchTransmissionCode=void 0})},e.onSearchReceiverClick=function(){e.transfer.receiver.identificationNumber==e.input.searchReceiverQuery||e.transfer.receiver.mobilephone==e.input.searchReceiverQuery?e.isReceiverSearchSuccess=!0:e.isReceiverSearchSuccess=!1},e.MarkTransmissionAsComplete=function(){var n={transfer:e.transfer};i.post("MarkTransmissionAsComplete",n).then(function(n){n.data.transferCompleted?e.isTransmissionCompleted=!0:e.isTransmissionCompleted=!1})},e.onSearchReceiverConfirmationCodeClick=function(){var n={confirmationCode:e.input.searchReceiverConfirmationCode,receiverId:e.transfer.receiver.id};i.post("CheckReceiverConfirmationCode",n).then(function(n){n.data.isCodeConfirmed?e.isReceiverConfirmationCodeSearchSuccess=!0:e.isReceiverConfirmationCodeSearchSuccess=!1,e.input.searchReceiverConfirmationCode=void 0})},e.$watch("show",function(n,o){n==o||n||(e.transfer={},e.input={},e.clearDisplayContainers(),e.isTransmissionCodeContainerVisible=!0,e.isTransferConfimed=!1,e.isSenderSearchSuccess=!1,e.isReceiverSearchSuccess=!1)}),e.transfer={},e.input={},e.isTransmissionCodeContainerVisible=!0,e.clearDisplayContainers=function(){e.isTransmissionCodeContainerVisible=!1,e.isReceiverContainerVisible=!1,e.isReceiverConfirmationContainerVisible=!1,e.isConfirmationContainerVisible=!1,e.isTransmissionInfoContainerVisible=!1},e.showTransmissionCodeContainer=function(){e.isTransmissionCodeContainerVisible=!0},e.showReceiverContainer=function(){e.isTransmissionCodeContainerVisible=!1,e.isReceiverContainerVisible=!0},e.showReceiverConfirmationContainer=function(){e.sendReceiverConfirmationCode(),e.isReceiverContainerVisible=!1,e.isReceiverConfirmationContainerVisible=!0},e.showTransmissionConfirmationContainer=function(){e.isReceiverConfirmationContainerVisible=!1,e.isConfirmationContainerVisible=!0},e.onConfirmTransmissionClick=function(){e.MarkTransmissionAsComplete(),e.isConfirmationContainerVisible=!1,e.isTransmissionInfoContainerVisible=!0}}],link:function(e,n,o){}}}]);